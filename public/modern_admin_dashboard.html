<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

:root {
  /* Modern Color Palette */
  --primary: #6366f1;
  --primary-hover: #5855eb;
  --primary-light: rgba(99, 102, 241, 0.1);
  --secondary: #8b5cf6;
  --secondary-hover: #7c3aed;
  --accent: #06b6d4;
  --accent-hover: #0891b2;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  
  /* Dark Theme Colors */
  --bg-primary: #0f0f23;
  --bg-secondary: #1a1a2e;
  --bg-tertiary: #16213e;
  --bg-card: rgba(26, 26, 46, 0.6);
  --bg-glass: rgba(255, 255, 255, 0.05);
  
  /* Text Colors */
  --text-primary: #ffffff;
  --text-secondary: #a0a9c0;
  --text-muted: #6b7280;
  
  /* Borders & Effects */
  --border: rgba(255, 255, 255, 0.1);
  --border-hover: rgba(255, 255, 255, 0.2);
  --shadow-glow: 0 0 20px rgba(99, 102, 241, 0.3);
  --shadow-card: 0 8px 32px rgba(0, 0, 0, 0.3);
  --shadow-elevated: 0 20px 40px rgba(0, 0, 0, 0.4);
  
  --radius: 16px;
  --radius-lg: 24px;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
  background-attachment: fixed;
  color: var(--text-primary);
  font-size: 14px;
  line-height: 1.6;
  min-height: 100vh;
  overflow-x: hidden;
}

/* Animated Background Elements */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    radial-gradient(circle at 20% 20%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 40% 60%, rgba(6, 182, 212, 0.05) 0%, transparent 50%);
  animation: float 20s ease-in-out infinite;
  pointer-events: none;
  z-index: -1;
}

@keyframes float {
  0%, 100% { transform: translateY(0px) rotate(0deg); }
  33% { transform: translateY(-20px) rotate(1deg); }
  66% { transform: translateY(10px) rotate(-1deg); }
}

.dashboard {
  display: flex;
  min-height: 100vh;
  position: relative;
}

/* Modern Sidebar */
.sidebar {
  width: 280px;
  background: var(--bg-card);
  backdrop-filter: blur(20px);
  border-right: 1px solid var(--border);
  padding: 0;
  display: flex;
  flex-direction: column;
  position: relative;
  overflow: hidden;
}

.sidebar::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(180deg, 
    rgba(99, 102, 241, 0.05) 0%, 
    rgba(139, 92, 246, 0.02) 50%, 
    rgba(6, 182, 212, 0.05) 100%);
  pointer-events: none;
}

.sidebar-header {
  padding: 32px 24px;
  border-bottom: 1px solid var(--border);
  position: relative;
  z-index: 1;
}

.sidebar-title {
  font-size: 24px;
  font-weight: 800;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 4px;
}

.sidebar-subtitle {
  font-size: 13px;
  color: var(--text-secondary);
  font-weight: 400;
}

.nav-menu {
  list-style: none;
  padding: 24px 16px;
  flex: 1;
  position: relative;
  z-index: 1;
}

.nav-item {
  margin-bottom: 8px;
}

.nav-link {
  display: flex;
  align-items: center;
  padding: 16px 20px;
  color: var(--text-secondary);
  text-decoration: none;
  border-radius: var(--radius);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  font-weight: 500;
  font-size: 15px;
  position: relative;
  overflow: hidden;
}

.nav-link::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 0%;
  height: 100%;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  border-radius: var(--radius);
}

.nav-link::after {
  content: '';
  position: absolute;
  top: 50%;
  right: 16px;
  width: 6px;
  height: 6px;
  background: var(--accent);
  border-radius: 50%;
  transform: translateY(-50%) scale(0);
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.nav-link:hover,
.nav-link.active {
  color: var(--text-primary);
  transform: translateX(4px);
  box-shadow: 0 8px 25px rgba(99, 102, 241, 0.2);
}

.nav-link:hover::before,
.nav-link.active::before {
  width: 100%;
}

.nav-link.active::after {
  transform: translateY(-50%) scale(1);
}

.nav-link span {
  position: relative;
  z-index: 1;
}

/* Main Content */
.main-content {
  flex: 1;
  padding: 40px;
  overflow-y: auto;
  position: relative;
}

.section {
  display: none;
  animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.section.active {
  display: block;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.page-header {
  margin-bottom: 40px;
  position: relative;
}

.page-title {
  font-size: 36px;
  font-weight: 800;
  background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 8px;
}

.page-subtitle {
  color: var(--text-secondary);
  font-size: 16px;
  font-weight: 400;
}

/* Modern Cards */
.card {
  background: var(--bg-card);
  backdrop-filter: blur(20px);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  margin-bottom: 32px;
  overflow: hidden;
  position: relative;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 1px;
  background: linear-gradient(90deg, 
    transparent, 
    var(--primary), 
    var(--secondary), 
    transparent);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.card:hover {
  transform: translateY(-8px);
  box-shadow: var(--shadow-elevated);
  border-color: var(--border-hover);
}

.card:hover::before {
  opacity: 1;
}

.card-header {
  padding: 28px 32px;
  border-bottom: 1px solid var(--border);
  background: linear-gradient(135deg, 
    rgba(99, 102, 241, 0.05) 0%, 
    rgba(139, 92, 246, 0.05) 100%);
}

.card-title {
  font-size: 20px;
  font-weight: 700;
  color: var(--text-primary);
  margin: 0;
}

.card-content {
  padding: 32px;
}

/* Enhanced Tables */
.table-container {
  overflow-x: auto;
  border-radius: var(--radius);
  background: var(--bg-glass);
  backdrop-filter: blur(10px);
}

table {
  width: 100%;
  border-collapse: collapse;
}

th {
  background: linear-gradient(135deg, 
    rgba(99, 102, 241, 0.1) 0%, 
    rgba(139, 92, 246, 0.1) 100%);
  padding: 20px 24px;
  text-align: left;
  font-weight: 600;
  color: var(--text-primary);
  border: none;
  font-size: 13px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

td {
  padding: 20px 24px;
  border-bottom: 1px solid var(--border);
  color: var(--text-primary);
  font-weight: 400;
}

tr {
  transition: all 0.3s ease;
}

tr:hover {
  background: rgba(99, 102, 241, 0.05);
  transform: scale(1.01);
}

tr.clickable {
  cursor: pointer;
  position: relative;
}

tr.clickable::after {
  content: '▶';
  position: absolute;
  right: 24px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--primary);
  font-size: 14px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  opacity: 0.6;
}

tr.clickable:hover::after {
  opacity: 1;
  transform: translateY(-50%) translateX(4px);
}

tr.clickable.expanded::after {
  transform: translateY(-50%) rotate(90deg);
  color: var(--accent);
}

/* Accordion Rows */
.employee-accordion {
  background: linear-gradient(135deg, 
    rgba(99, 102, 241, 0.02) 0%, 
    rgba(139, 92, 246, 0.02) 100%);
  display: none;
}

.employee-accordion.show {
  display: table-row;
}

.employee-accordion td {
  padding: 0;
}

.employee-accordion-content {
  padding: 32px;
  animation: slideDown 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.employee-accordion-title {
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 20px;
  font-size: 16px;
  position: relative;
  padding-left: 16px;
}

.employee-accordion-title::before {
  content: '';
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  width: 4px;
  height: 20px;
  background: linear-gradient(135deg, var(--primary), var(--accent));
  border-radius: 2px;
}

.employee-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 16px;
}

.employee-card {
  background: var(--bg-glass);
  backdrop-filter: blur(10px);
  padding: 20px 24px;
  border-radius: var(--radius);
  border: 1px solid var(--border);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.employee-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 2px;
  background: linear-gradient(90deg, var(--primary), var(--accent));
  transform: scaleX(0);
  transition: transform 0.3s ease;
}

.employee-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
  border-color: var(--border-hover);
}

.employee-card:hover::before {
  transform: scaleX(1);
}

.employee-card-name {
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 6px;
  font-size: 15px;
}

.employee-card-email {
  color: var(--text-secondary);
  font-size: 13px;
}

/* Enhanced Forms */
.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 40px;
  align-items: start;
}

.form-group {
  margin-bottom: 24px;
}

.form-label {
  display: block;
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 8px;
  position: relative;
}

.form-input,
.form-select {
  width: 100%;
  padding: 16px 20px;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  font-size: 15px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  background: var(--bg-glass);
  backdrop-filter: blur(10px);
  color: var(--text-primary);
  font-weight: 400;
}

.form-input:focus,
.form-select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1), var(--shadow-glow);
  transform: translateY(-2px);
}

.form-input::placeholder {
  color: var(--text-muted);
}

/* Employee List Container */
.employees-container {
  max-height: 450px;
  overflow-y: auto;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  background: var(--bg-glass);
  backdrop-filter: blur(10px);
}

.employees-container::-webkit-scrollbar {
  width: 6px;
}

.employees-container::-webkit-scrollbar-track {
  background: transparent;
}

.employees-container::-webkit-scrollbar-thumb {
  background: var(--primary);
  border-radius: 3px;
}

.employee-item {
  display: flex;
  align-items: center;
  padding: 20px;
  border-bottom: 1px solid var(--border);
  transition: all 0.3s ease;
  position: relative;
}

.employee-item:last-child {
  border-bottom: none;
}

.employee-item:hover {
  background: rgba(99, 102, 241, 0.05);
  transform: translateX(4px);
}

.employee-checkbox {
  margin-right: 16px;
  width: 18px;
  height: 18px;
  accent-color: var(--primary);
  cursor: pointer;
}

.employee-info {
  flex: 1;
}

.employee-name {
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 4px;
  font-size: 15px;
}

.employee-details {
  font-size: 13px;
  color: var(--text-secondary);
}

/* Modern Buttons */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 14px 24px;
  border: none;
  border-radius: var(--radius);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  text-decoration: none;
  position: relative;
  overflow: hidden;
  min-height: 48px;
}

.btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.6s ease;
}

.btn:hover::before {
  left: 100%;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary), var(--primary-hover));
  color: white;
  box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
}

.btn-secondary {
  background: var(--bg-glass);
  backdrop-filter: blur(10px);
  color: var(--text-primary);
  border: 1px solid var(--border);
}

.btn-secondary:hover {
  background: var(--bg-tertiary);
  border-color: var(--border-hover);
  transform: translateY(-2px);
}

.btn-outline {
  background: transparent;
  color: var(--primary);
  border: 2px solid var(--primary);
}

.btn-outline:hover {
  background: var(--primary);
  color: white;
  transform: translateY(-2px);
  box-shadow: var(--shadow-glow);
}

.btn-group {
  display: flex;
  gap: 16px;
  margin-top: 24px;
}

/* Status Messages */
.status-message {
  padding: 16px 20px;
  border-radius: var(--radius);
  font-size: 14px;
  font-weight: 500;
  margin-top: 20px;
  position: relative;
  overflow: hidden;
  backdrop-filter: blur(10px);
}

.status-message::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 4px;
  height: 100%;
  transition: width 0.3s ease;
}

.status-success {
  background: rgba(16, 185, 129, 0.1);
  color: var(--success);
  border: 1px solid rgba(16, 185, 129, 0.3);
}

.status-success::before {
  background: var(--success);
}

.status-error {
  background: rgba(239, 68, 68, 0.1);
  color: var(--danger);
  border: 1px solid rgba(239, 68, 68, 0.3);
}

.status-error::before {
  background: var(--danger);
}

.status-info {
  background: rgba(99, 102, 241, 0.1);
  color: var(--primary);
  border: 1px solid rgba(99, 102, 241, 0.3);
}

.status-info::before {
  background: var(--primary);
}

/* Assignments Display */
.assignments-list {
  margin-top: 24px;
}

.manager-group {
  margin-bottom: 32px;
  background: var(--bg-glass);
  backdrop-filter: blur(10px);
  border-radius: var(--radius);
  padding: 24px;
  border: 1px solid var(--border);
  transition: all 0.3s ease;
}

.manager-group:hover {
  border-color: var(--border-hover);
  transform: translateY(-2px);
}

.manager-group-title {
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 16px;
  font-size: 16px;
  position: relative;
  padding-left: 20px;
}

.manager-group-title::before {
  content: '';
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  width: 6px;
  height: 6px;
  background: var(--accent);
  border-radius: 50%;
  box-shadow: 0 0 10px var(--accent);
}

.employee-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.employee-list li {
  padding: 12px 0;
  color: var(--text-secondary);
  font-size: 14px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  transition: all 0.3s ease;
}

.employee-list li:last-child {
  border-bottom: none;
}

.employee-list li:hover {
  color: var(--text-primary);
  padding-left: 8px;
}

/* Loading States */
.loading,
.empty-state,
.no-employees {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 48px;
  color: var(--text-muted);
  font-style: italic;
  text-align: center;
}

/* Responsive Design */
@media (max-width: 1200px) {
  .form-grid {
    grid-template-columns: 1fr;
    gap: 24px;
  }
}

@media (max-width: 768px) {
  .sidebar {
    display: none;
  }
  
  .main-content {
    padding: 24px 16px;
  }
  
  .page-title {
    font-size: 28px;
  }
  
  .card-content {
    padding: 20px;
  }
  
  .employee-grid {
    grid-template-columns: 1fr;
  }
}

/* Lead Assignment Styles */
.checkbox-item {
  display: flex;
  align-items: center;
  padding: 16px;
  border-bottom: 1px solid var(--border);
  cursor: pointer;
  transition: all 0.3s ease;
}

.checkbox-item:hover {
  background: rgba(99, 102, 241, 0.05);
}

.checkbox-item input[type="checkbox"] {
  margin-right: 12px;
  accent-color: var(--primary);
}

.assignment-item {
  padding: 16px;
  background: var(--bg-glass);
  backdrop-filter: blur(10px);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  margin-bottom: 12px;
  transition: all 0.3s ease;
}

.assignment-item:hover {
  border-color: var(--border-hover);
  transform: translateY(-2px);
}

/* Custom Scrollbar */
* {
  scrollbar-width: thin;
  scrollbar-color: var(--primary) transparent;
}

*::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

*::-webkit-scrollbar-track {
  background: transparent;
}

*::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border-radius: 4px;
}

*::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(135deg, var(--primary-hover), var(--secondary-hover));
}
</style>
</head>
<body>

<div class="dashboard">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <h1 class="sidebar-title">Admin Panel</h1>
      <p class="sidebar-subtitle">Employee Management System</p>
    </div>
    
    <nav>
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="#" class="nav-link active" onclick="showSection('managers')">
            <span>Managers</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" onclick="showSection('employees')">
            <span>Employees</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" onclick="showSection('leads')">
            <span>Leads</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" onclick="showSection('assign')">
            <span>Assign Employees</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" onclick="showSection('lead-assign')">
            <span>Lead Employees</span>
          </a>
        </li>
      </ul>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Managers Section -->
    <section id="managers" class="section active">
      <div class="page-header">
        <h1 class="page-title">Managers</h1>
        <p class="page-subtitle">View and manage all managers in the system</p>
      </div>

      <div class="card">
        <div class="card-header">
          <h2 class="card-title">All Managers</h2>
        </div>
        <div class="card-content">
          <div class="table-container">
            <table id="managersTable">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Created At</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- Employees Section -->
    <section id="employees" class="section">
      <div class="page-header">
        <h1 class="page-title">Employees</h1>
        <p class="page-subtitle">View all employees and their assigned managers</p>
      </div>

      <div class="card">
        <div class="card-header">
          <h2 class="card-title">All Employees</h2>
        </div>
        <div class="card-content">
          <div class="table-container">
            <table id="employeesTable">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Manager</th>
                  <th>Created At</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- Leads Section -->
    <section id="leads" class="section">
      <div class="page-header">
        <h1 class="page-title">Leads</h1>
        <p class="page-subtitle">Manage all leads and prospects</p>
      </div>

      <div class="card">
        <div class="card-header">
          <h2 class="card-title">All Leads</h2>
        </div>
        <div class="card-content">
          <div class="table-container">
            <table id="leadsTable">
              <thead id="leadsHead"></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- Assign Section -->
    <section id="assign" class="section">
      <div class="page-header">
        <h1 class="page-title">Assign Employees</h1>
        <p class="page-subtitle">Choose a manager and assign one or more employees to them</p>
      </div>

      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Assignment Tool</h2>
        </div>
        <div class="card-content">
          <div class="form-grid">
            <!-- Left: Manager selection and controls -->
            <div>
              <div class="form-group">
                <label class="form-label" for="managerSelect">Select Manager</label>
                <select id="managerSelect" class="form-select">
                  <option value="">Loading managers...</option>
                </select>
              </div>

              <div class="form-group">
                <label class="form-label" for="searchEmployees">Search Employees</label>
                <input type="text" id="searchEmployees" class="form-input" placeholder="Search by name or email">
              </div>

              <div class="btn-group">
                <button id="assignBtn" class="btn btn-primary">Assign Selected</button>
                <button id="clearBtn" class="btn btn-secondary">Clear Selection</button>
                <button id="refreshBtn" class="btn btn-outline">Refresh</button>
              </div>

              <div id="statusMsg" class="status-message" style="display: none;" aria-live="polite"></div>
            </div>

            <!-- Right: Employees list -->
            <div>
              <label class="form-label">Available Employees</label>
              <div class="employees-container" id="employeesList">
                <div class="loading">Loading employees...</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Current Assignments</h2>
        </div>
        <div class="card-content">
          <div id="assignmentsContainer" class="loading">Loading assignments...</div>
        </div>
      </div>
    </section>

    <!-- Lead Assign Section -->
    <section id="lead-assign" class="section">
      <div class="page-header">
        <h1 class="page-title">Assign Leads</h1>
        <p class="page-subtitle">Choose a user (employee) and assign one or more leads to them</p>
      </div>

      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Lead Assignment Tool</h2>
        </div>
        <div class="card-content">
          <div class="form-grid">
            <!-- Left: User selection and controls -->
            <div>
              <div class="form-group">
                <label class="form-label" for="userSelect">Select User</label>
                <select id="userSelect" class="form-select">
                  <option value="">Loading users...</option>
                </select>
              </div>

              <div class="form-group">
                <label class="form-label" for="searchLeads">Search Leads</label>
                <input type="text" id="searchLeads" class="form-input" placeholder="Search by name or email">
              </div>

              <div class="btn-group">
                <button id="leadAssignBtn" class="btn btn-primary">Assign Selected</button>
                <button id="leadClearBtn" class="btn btn-secondary">Clear Selection</button>
                <button id="leadRefreshBtn" class="btn btn-outline">Refresh</button>
              </div>

              <div id="leadStatusMsg" class="status-message" style="display: none;" aria-live="polite"></div>
            </div>

            <!-- Right: Leads list -->
            <div>
              <label class="form-label">Available Leads</label>
              <div class="employees-container" id="leadsList">
                <div class="loading">Loading leads...</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Current Assignments -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Current Lead Assignments</h2>
        </div>
        <div class="card-content">
          <div id="leadAssignmentsContainer" class="loading">Loading assignments...</div>
        </div>
      </div>
    </section>
  </main>
</div>

<!-- Script for Lead Assignment -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const userSelect = document.getElementById("userSelect");
  const leadsList = document.getElementById("leadsList");
  const assignmentsContainer = document.getElementById("leadAssignmentsContainer");
  const searchLeads = document.getElementById("searchLeads");
  const statusMsg = document.getElementById("leadStatusMsg");

  async function fetchUsers() {
    try {
      const res = await fetch("/api/leads/users");
      const users = await res.json();
      userSelect.innerHTML = `<option value="">-- Select User --</option>`;
      users.forEach(user => {
        userSelect.innerHTML += `<option value="${user._id}">${user.name} (${user.email})</option>`;
      });
    } catch (err) {
      console.error("Error fetching users", err);
    }
  }

  async function fetchLeads() {
    try {
      const res = await fetch("/api/leads/unassigned");
      const leads = await res.json();
      renderLeads(leads);
    } catch (err) {
      console.error("Error fetching leads", err);
    }
  }

  function renderLeads(leads) {
    leadsList.innerHTML = "";
    if (!leads.length) {
      leadsList.innerHTML = "<p>No unassigned leads found.</p>";
      return;
    }
    leads.forEach(lead => {
      leadsList.innerHTML += `
        <label class="checkbox-item">
          <input type="checkbox" value="${lead._id}" />
          <span>${lead.name} - ${lead.email || 'No email'} - ${lead.phone}</span>
        </label>
      `;
    });
  }

  async function fetchAssignments() {
    try {
      const res = await fetch("/api/leads/assignments");
      const assignments = await res.json();
      assignmentsContainer.innerHTML = "";
      if (!assignments.length) {
        assignmentsContainer.innerHTML = "<p>No assigned leads found.</p>";
        return;
      }
      assignments.forEach(lead => {
        assignmentsContainer.innerHTML += `
          <div class="assignment-item">
            <strong>${lead.name}</strong> - ${lead.email || 'No email'} - Assigned to: ${lead.assignedTo?.name || 'N/A'}
          </div>
        `;
      });
    } catch (err) {
      console.error("Error fetching assignments", err);
    }
  }

  document.getElementById("leadAssignBtn").addEventListener("click", async () => {
    const selectedUser = userSelect.value;
    const selectedLeads = [...leadsList.querySelectorAll("input[type=checkbox]:checked")].map(cb => cb.value);

    if (!selectedUser || selectedLeads.length === 0) {
      alert("Please select a user and at least one lead.");
      return;
    }

    try {
      const res = await fetch("/api/leads/assign", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ userId: selectedUser, leadIds: selectedLeads })
      });

      const data = await res.json();
      statusMsg.textContent = data.message || "Assignment completed";
      statusMsg.style.display = "block";
      fetchLeads();
      fetchAssignments();
    } catch (err) {
      console.error("Error assigning leads", err);
    }
  });

  document.getElementById("leadClearBtn").addEventListener("click", () => {
    leadsList.querySelectorAll("input[type=checkbox]").forEach(cb => cb.checked = false);
  });

  document.getElementById("leadRefreshBtn").addEventListener("click", () => {
    fetchLeads();
    fetchAssignments();
  });

  searchLeads.addEventListener("input", async (e) => {
    const query = e.target.value.toLowerCase();
    const res = await fetch("/api/leads/unassigned");
    const leads = await res.json();
    const filtered = leads.filter(lead =>
      lead.name.toLowerCase().includes(query) ||
      (lead.email && lead.email.toLowerCase().includes(query))
    );
    renderLeads(filtered);
  });

  // Initial load
  fetchUsers();
  fetchLeads();
  fetchAssignments();
});
</script>

<script>
// Navigation
function showSection(sectionId) {
  // Update active nav link
  document.querySelectorAll('.nav-link').forEach(link => {
    link.classList.remove('active');
  });
  event.target.classList.add('active');
  
  // Show/hide sections
  document.querySelectorAll('.section').forEach(section => {
    section.classList.remove('active');
  });
  document.getElementById(sectionId).classList.add('active');
}

// Utility functions
function getAuthHeader() {
  const token = localStorage.getItem('token');
  return token ? { 'Authorization': 'Bearer ' + token } : {};
}

function escapeHtml(str) {
  return String(str || '').replace(/[&<>"'`=\/]/g, s => ({
    '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;',"/":'&#x2F;', "`":'&#x60;','=':'&#x3D;'
  })[s]);
}

function showStatus(message, type = 'info') {
  const statusEl = document.getElementById('statusMsg');
  statusEl.textContent = message;
  statusEl.className = `status-message status-${type}`;
  statusEl.style.display = 'block';
}

function hideStatus() {
  const statusEl = document.getElementById('statusMsg');
  statusEl.style.display = 'none';
}

// Managers functionality
async function loadManagers() {
  try {
    const res = await fetch('/api/admin/managers', { headers: {...getAuthHeader()} });
    if (!res.ok) throw new Error('Failed to load managers');
    
    const data = await res.json();
    const tbody = document.querySelector('#managersTable tbody');
    tbody.innerHTML = '';
    
    data.forEach((manager, index) => {
      // Manager row
      const tr = document.createElement('tr');
      tr.className = 'clickable';
      tr.dataset.managerId = manager._id;
      tr.dataset.expanded = 'false';
      tr.innerHTML = `
        <td>${escapeHtml(manager.name)}</td>
        <td>${escapeHtml(manager.email)}</td>
        <td>${new Date(manager.createdAt).toLocaleDateString()}</td>
      `;
      
      // Employee accordion row (initially hidden)
      const accordionTr = document.createElement('tr');
      accordionTr.className = 'employee-accordion';
      accordionTr.id = `accordion-${manager._id}`;
      accordionTr.innerHTML = `
        <td colspan="3">
          <div class="employee-accordion-content">
            <div class="employee-accordion-title">Assigned Employees</div>
            <div id="employees-${manager._id}" class="employee-grid">
              <div style="text-align: center; padding: 20px; color: var(--text-muted);">Loading...</div>
            </div>
          </div>
        </td>
      `;
      
      // Click handler for accordion
      tr.addEventListener('click', () => toggleManagerAccordion(manager._id, tr));
      
      tbody.appendChild(tr);
      tbody.appendChild(accordionTr);
    });
  } catch (err) {
    console.error('Error loading managers:', err);
  }
}

async function toggleManagerAccordion(managerId, managerRow) {
  const accordionRow = document.getElementById(`accordion-${managerId}`);
  const isExpanded = managerRow.dataset.expanded === 'true';
  
  if (isExpanded) {
    // Collapse
    accordionRow.classList.remove('show');
    managerRow.classList.remove('expanded');
    managerRow.dataset.expanded = 'false';
  } else {
    // Expand
    accordionRow.classList.add('show');
    managerRow.classList.add('expanded');
    managerRow.dataset.expanded = 'true';
    
    // Load employees if not already loaded
    await loadManagerEmployees(managerId);
  }
}

async function loadManagerEmployees(managerId) {
  const container = document.getElementById(`employees-${managerId}`);
  
  try {
    // Get all employees and filter by manager on frontend
    const res = await fetch('/api/admin/employees', { headers: {...getAuthHeader()} });
    if (!res.ok) throw new Error('Failed to load employees');
    
    const allEmployees = await res.json();
    // Filter employees by the selected manager
    const employees = allEmployees.filter(emp => 
      emp.manager && (emp.manager === managerId || emp.manager._id === managerId)
    );
    
    if (employees.length === 0) {
      container.innerHTML = '<div class="no-employees">No employees assigned to this manager</div>';
    } else {
      container.innerHTML = employees.map(emp => `
        <div class="employee-card">
          <div class="employee-card-name">${escapeHtml(emp.name)}</div>
          <div class="employee-card-email">${escapeHtml(emp.email)}</div>
        </div>
      `).join('');
    }
  } catch (err) {
    console.error('Error loading manager employees:', err);
    container.innerHTML = '<div class="no-employees" style="color: var(--danger);">Error loading employees</div>';
  }
}

async function showManagerEmployees(managerId) {
  // This function is kept for backward compatibility but now handled by accordion
  await loadManagerEmployees(managerId);
}

// Employees functionality
async function loadEmployees() {
  try {
    const res = await fetch('/api/admin/employees', { headers: {...getAuthHeader()} });
    if (!res.ok) throw new Error('Failed to load employees');
    
    const data = await res.json();
    const tbody = document.querySelector('#employeesTable tbody');
    tbody.innerHTML = '';
    
    data.forEach(emp => {
      const managerName = emp.manager ? emp.manager.name : 'Unassigned';
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${escapeHtml(emp.name)}</td>
        <td>${escapeHtml(emp.email)}</td>
        <td>${escapeHtml(managerName)}</td>
        <td>${new Date(emp.createdAt).toLocaleDateString()}</td>
      `;
      tbody.appendChild(tr);
    });
  } catch (err) {
    console.error('Error loading employees:', err);
  }
}

// Leads functionality
async function loadLeads() {
  try {
    const res = await fetch('/api/admin/leads', { headers: {...getAuthHeader()} });
    if (!res.ok) throw new Error('Failed to load leads');
    
    const data = await res.json();
    const thead = document.getElementById('leadsHead');
    const tbody = document.querySelector('#leadsTable tbody');

    if (data.length > 0) {
      const keys = Object.keys(data[0]).filter(k => k !== '_id');
      thead.innerHTML = `<tr>${keys.map(k => `<th>${escapeHtml(k)}</th>`).join('')}</tr>`;
      tbody.innerHTML = '';
      data.forEach(lead => {
        tbody.innerHTML += `<tr>${keys.map(k => `<td>${escapeHtml(lead[k])}</td>`).join('')}</tr>`;
      });
    }
  } catch (err) {
    console.error('Error loading leads:', err);
  }
}

// Assignment functionality
let allEmployees = [];

async function loadManagersForAssignment() {
  const sel = document.getElementById('managerSelect');
  sel.innerHTML = '<option value="">Loading managers...</option>';

  try {
    const res = await fetch('/api/admin/managers', { headers: {...getAuthHeader()} });
    if (!res.ok) throw new Error('Failed to load managers');
    
    const data = await res.json();
    sel.innerHTML = '<option value="">-- Select Manager --</option>';
    data.forEach(m => {
      const opt = document.createElement('option');
      opt.value = m._id;
      opt.textContent = `${m.name} (${m.email || 'no-email'})`;
      sel.appendChild(opt);
    });
  } catch (err) {
    sel.innerHTML = '<option value="">Error loading managers</option>';
    console.error('Error loading managers for assignment:', err);
  }
}

async function loadEmployeesForAssignment() {
  const container = document.getElementById('employeesList');
  container.innerHTML = '<div class="loading">Loading employees...</div>';
  
  try {
    const res = await fetch('/api/admin/employees', { headers: {...getAuthHeader()} });
    if (!res.ok) throw new Error('Failed to load employees');
    
    const data = await res.json();
    allEmployees = data;
    renderEmployeesForAssignment(data);
  } catch (err) {
    container.innerHTML = '<div class="empty-state">Error loading employees</div>';
    console.error('Error loading employees for assignment:', err);
  }
}

function renderEmployeesForAssignment(employees) {
  const container = document.getElementById('employeesList');
  
  if (!employees.length) {
    container.innerHTML = '<div class="empty-state">No employees found</div>';
    return;
  }
  
  container.innerHTML = '';
  employees.forEach(emp => {
    const item = document.createElement('div');
    item.className = 'employee-item';
    item.innerHTML = `
      <input class="employee-checkbox" type="checkbox" data-id="${emp._id}">
      <div class="employee-info">
        <div class="employee-name">${escapeHtml(emp.name || 'Unnamed')}</div>
        <div class="employee-details">
          ${escapeHtml(emp.email || 'no-email')} • 
          Manager: ${emp.manager ? escapeHtml(emp.manager.name || emp.manager) : 'Unassigned'}
        </div>
      </div>
    `;
    container.appendChild(item);
  });
}

async function loadAssignments() {
  const container = document.getElementById('assignmentsContainer');
  container.innerHTML = '<div class="loading">Loading assignments...</div>';
  
  try {
    const [mRes, eRes] = await Promise.all([
      fetch('/api/admin/managers', { headers: {...getAuthHeader()} }),
      fetch('/api/admin/employees', { headers: {...getAuthHeader()} })
    ]);
    
    if (!mRes.ok || !eRes.ok) throw new Error('Failed to load data');

    const managers = await mRes.json();
    const employees = await eRes.json();

    // Map managerId -> manager name
    const managerMap = {};
    managers.forEach(m => managerMap[m._id] = m.name);

    // Group employees by manager
    const grouped = {};
    employees.forEach(emp => {
      const managerId = emp.manager || 'unassigned';
      if (!grouped[managerId]) grouped[managerId] = [];
      grouped[managerId].push(emp);
    });

    // Render assignments
    let html = '<div class="assignments-list">';
    Object.keys(grouped).forEach(managerId => {
      const managerName = managerId === 'unassigned' ? 'Unassigned' : (managerMap[managerId] || 'Unknown Manager');
      html += `
        <div class="manager-group">
          <div class="manager-group-title">${escapeHtml(managerName)} (${grouped[managerId].length})</div>
          <ul class="employee-list">
            ${grouped[managerId].map(emp => 
              `<li>${escapeHtml(emp.name)} — ${escapeHtml(emp.email || 'no-email')}</li>`
            ).join('')}
          </ul>
        </div>
      `;
    });
    html += '</div>';
    
    container.innerHTML = html || '<div class="empty-state">No assignments found</div>';
  } catch (err) {
    container.innerHTML = '<div class="empty-state">Error loading assignments</div>';
    console.error('Error loading assignments:', err);
  }
}

async function assignSelected() {
  const managerId = document.getElementById('managerSelect').value;
  const checkboxes = Array.from(document.querySelectorAll('.employee-checkbox:checked'));

  if (!managerId) {
    showStatus('Please select a manager.', 'error');
    return;
  }
  
  if (!checkboxes.length) {
    showStatus('Please select at least one employee.', 'error');
    return;
  }

  showStatus('Assigning employees...', 'info');
  
  try {
    const tokenHeader = getAuthHeader();
    const results = [];
    
    for (const checkbox of checkboxes) {
      const employeeId = checkbox.getAttribute('data-id');
      const res = await fetch('/api/admin/assign-employee', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', ...tokenHeader },
        body: JSON.stringify({ employeeId, managerId })
      });
      const json = await res.json();
      results.push({ ok: res.ok, json });
    }

    const failed = results.filter(r => !r.ok);
    if (failed.length) {
      showStatus(`Assigned ${results.length - failed.length} / ${results.length} employees. ${failed.length} failed.`, 'error');
      console.error('Failed assignments:', failed);
    } else {
      showStatus(`Successfully assigned ${results.length} employees.`, 'success');
    }

    // Refresh data
    await Promise.all([loadEmployeesForAssignment(), loadAssignments()]);
  } catch (err) {
    console.error('Assignment error:', err);
    showStatus('Server error during assignment.', 'error');
  }
}

function clearSelection() {
  document.querySelectorAll('.employee-checkbox').forEach(cb => cb.checked = false);
  showStatus('Selection cleared.', 'info');
}

function initSearch() {
  const input = document.getElementById('searchEmployees');
  input.addEventListener('input', () => {
    const query = input.value.trim().toLowerCase();
    if (!query) {
      renderEmployeesForAssignment(allEmployees);
      return;
    }
    
    const filtered = allEmployees.filter(emp => 
      (emp.name && emp.name.toLowerCase().includes(query)) ||
      (emp.email && emp.email.toLowerCase().includes(query))
    );
    renderEmployeesForAssignment(filtered);
  });
}

// Event listeners
document.getElementById('assignBtn').addEventListener('click', assignSelected);
document.getElementById('clearBtn').addEventListener('click', clearSelection);
document.getElementById('refreshBtn').addEventListener('click', async () => {
  showStatus('Refreshing data...', 'info');
  await Promise.all([loadManagersForAssignment(), loadEmployeesForAssignment(), loadAssignments()]);
  hideStatus();
});

// Initialize
(async function init() {
  await Promise.all([loadManagers(), loadEmployees(), loadLeads()]);
  await Promise.all([loadManagersForAssignment(), loadEmployeesForAssignment(), loadAssignments()]);
  initSearch();
})();
</script>

</body>
</html>